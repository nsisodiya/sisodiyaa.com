<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>DoonB2B Product Info</title>
    <style>
      body {
        font-family: 'Segoe UI', sans-serif;
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      #scanner-container {
        width: 100%;
        position: relative;
      }
      #scanner-container video {
        width: 100%;
        height: auto;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }
      #scanner-container .drawingBuffer {
        display: none;
      }
      #scanner-container canvas {
        display: none;
      }
      .price-info {
        font-size: 35px;
        font-weight: bold;
        color: #236591;
      }
      #product-info {
        box-sizing: border-box;
        padding: 20px;
        background: #fff;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        display: none;
        text-align: center;
        width: 100%;
      }
      #product-info #product-name {
        font-size: 40px;
        color: #236591;
        font-weight: bold;
      }
      #product-info #sku {
        font-size: 30px;
        color: #236591;
        font-weight: bold;
      }
      .carousel {
        overflow-x: auto;
        display: flex;
        scroll-snap-type: x mandatory;
        gap: 10px;
        margin: 20px 0;
      }
      .carousel img {
        scroll-snap-align: center;
        flex-shrink: 0;
        width: 100%;
        max-width: 86%;
        border-radius: 8px;
        object-fit: contain;
      }
      button.scan-again {
        width: 100%;
        padding: 15px;
        font-size: 40px;
        background: #236591;
        color: #fff;
        border: none;
        cursor: pointer;
      }
      .insta-embed {
        width: 100%;
        height: auto;
        margin-top: 20px;
      }
      .insta-embed iframe {
        width: 100% !important;
      }
    </style>
  </head>
  <body>
    <button class="scan-again" onclick="startScanner()">Scan Again</button>
    <div id="scanner-container"></div>
    <div id="product-info">
      <h2 id="product-name"></h2>
      <p><span id="sku"></span></p>
      <div class="price-info">
        <p>Sale Price: <span id="sale-price"></span></p>
      </div>
      <div class="carousel" id="image-carousel"></div>
      <div class="insta-embed" id="insta-container"></div>
    </div>

    <script src="https://unpkg.com/@ericblade/quagga2@1.2.6/dist/quagga.min.js"></script>
    <script src="./public-product-info.js"></script>

    <script async src="https://www.instagram.com/embed.js"></script>
    <script>
      // window.productInfo = {
      //   2337: {
      //     itemCode: '2337',
      //     instalUrl:
      //       'https://www.instagram.com/reel/DI4ZoHAyZER/?igsh=MWp4NjI5NDllYWNydQ==',
      //     handle: 'heavy-duty-juice-press-squeezer-with-juicers',
      //     title: 'Heavy Duty Juice Press Squeezer with juicers ( 1 pcs )',
      //     sku: '2337_hand_press_juicer_big',
      //     images: [
      //       'https://cdn.shopify.com/s/files/1/0782/3284/6646/files/006_3a132c1e-6b34-47d1-874b-70397c28089c.jpg?v=1737623254',
      //       'https://cdn.shopify.com/s/files/1/0782/3284/6646/files/01_1c13b92b-512c-4b3a-b7eb-f65d69bd6c26.jpg?v=1737623254',
      //       'https://cdn.shopify.com/s/files/1/0782/3284/6646/files/05_7563ce38-aa61-4259-b176-4e76c80bb1c5.jpg?v=1737623254',
      //       'https://cdn.shopify.com/s/files/1/0782/3284/6646/files/04_ed96f89a-b252-4123-856a-fc4bd9077e58.jpg?v=1737623254',
      //       'https://cdn.shopify.com/s/files/1/0782/3284/6646/files/07_664a2dd2-74b8-4d61-9cce-1eadd02d68f7.jpg?v=1737623254',
      //       'https://cdn.shopify.com/s/files/1/0782/3284/6646/files/08_76c5c1dd-7337-4a36-b865-48680fa48d41.jpg?v=1737623254',
      //       'https://cdn.shopify.com/s/files/1/0782/3284/6646/files/02_af714000-668a-453c-9bc7-7ac4575fb47f.jpg?v=1737623254',
      //       'https://cdn.shopify.com/s/files/1/0782/3284/6646/files/03_1e96fdcc-9baa-4b0e-84b5-9f95647ad2d4.jpg?v=1737623255'
      //     ],
      //     salePrice: 164
      //   }
      // };

      function startScanner() {
        document.getElementById('scanner-container').style.display = 'block';
        document.getElementById('product-info').style.display = 'none';
        Quagga.stop();

        Quagga.init(
          {
            inputStream: {
              name: 'Live',
              type: 'LiveStream',
              target: document.querySelector('#scanner-container'),
              constraints: {
                facingMode: 'environment'
              }
            },
            decoder: {
              readers: ['ean_reader', 'code_128_reader', 'upc_reader']
            }
          },
          function (err) {
            if (err) {
              console.error(err);
              return;
            }
            Quagga.start();
          }
        );

        Quagga.onDetected((result) => {
          const code = result.codeResult.code;
          if (window.productInfo[code]) {
            showProduct(window.productInfo[code]);
            Quagga.stop();
          } else {
            console.warn('SKU not found:', code);
          }
        });
      }

      function showProduct(data) {
        document.getElementById('scanner-container').style.display = 'none';
        const carousel = document.getElementById('image-carousel');
        carousel.innerHTML = '';
        data.images.forEach((imgUrl) => {
          const img = document.createElement('img');
          img.src = imgUrl;
          carousel.appendChild(img);
        });

        document.getElementById('product-name').innerText = data.title;
        document.getElementById('sku').innerText = data.sku;
        document.getElementById('sale-price').innerText = data.salePrice;

        const instaContainer = document.getElementById('insta-container');
        instaContainer.innerHTML = data.instalUrl
          ? `<blockquote class="instagram-media" data-instgrm-permalink="${data.instalUrl}" data-instgrm-version="14"></blockquote>`
          : '';
        if (window.instgrm) window.instgrm.Embeds.process();

        document.getElementById('product-info').style.display = 'block';
      }
      window.onload = () => {
        startScanner();
      };
    </script>
  </body>
</html>
