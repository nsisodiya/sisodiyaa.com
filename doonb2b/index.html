<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>DoonB2B, Dehradun</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        background: #e1e1e1;
      }
      header {
        background: #2c3e50;
        color: white;
        text-align: center;
        font-size: 1.2rem;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 1rem;
      }
      header img {
        max-width: 100%;
        max-height: 130px;
      }
      .catalog-list,
      .product-list {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
        gap: 1rem;
        padding: 1rem;
      }
      .catalog-item,
      .product-item {
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        overflow: hidden;
        text-align: center;
        cursor: pointer;
        transition: transform 0.2s ease;
      }
      .catalog-item:hover,
      .product-item:hover {
        transform: scale(1.03);
      }
      .catalog-item img,
      .product-item img {
        width: 100%;
        height: 150px;
        object-fit: cover;
      }
      .catalog-title,
      .product-title {
        padding: 0.2rem;
        font-size: 0.8rem;
        text-transform: capitalize;
      }
      .hidden {
        display: none;
      }
      .back-link {
        margin: 1rem;
        display: block;
        color: #2c3e50;
        text-decoration: none;
        font-weight: bold;
      }
      .search-box {
        margin: 1rem;
        text-align: center;
      }
      .search-box input {
        width: 90%;
        padding: 0.5rem;
        font-size: 1rem;
        border: 1px solid #ccc;
        border-radius: 5px;
      }
      #categoryTitle {
        margin: 1rem;
        font-size: 1.4rem;
        text-transform: capitalize;
        color: #2c3e50;
      }
    </style>
  </head>
  <body>
    <header>
      <img
        src="https://sisodiyaa.com/doonb2b/doonb2b-color-rect-logo-solid-white-bg.png"
        alt="DoonB2B Logo"
      />
    </header>

    <div class="search-box">
      <input type="text" id="searchInput" placeholder="Search products..." />
    </div>

    <div id="catalogList" class="catalog-list"></div>
    <div id="productListWrapper" class="hidden">
      <a href="#" id="backLink" class="back-link">← Back to Catalogs</a>
      <h2 id="categoryTitle"></h2>
      <div id="productList" class="product-list"></div>
    </div>

    <script src="https://sisodiyaa.com/doonb2b/public-product-info.js"></script>
    <script>
      function getThumbnailImage(url) {
        return url.replace(
          /(\.jpg|\.png|\.webp|\.jpeg)(\?.*)?$/,
          '_150x150$1$2'
        );
      }

      window.addEventListener('load', () => {
        const catalogData = {};
        const catalogCounts = {};
        const productInfo = window.productInfo;

        for (const sku in productInfo.skuToProductInfo) {
          const product = productInfo.skuToProductInfo[sku];
          if (!catalogData[product.catalog]) {
            catalogData[product.catalog] = product.images[0];
            catalogCounts[product.catalog] = 1;
          } else {
            catalogCounts[product.catalog]++;
          }
        }

        const catalogList = document.getElementById('catalogList');
        const productList = document.getElementById('productList');
        const productListWrapper =
          document.getElementById('productListWrapper');
        const backLink = document.getElementById('backLink');
        const categoryTitle = document.getElementById('categoryTitle');
        const searchInput = document.getElementById('searchInput');

        function showCatalogs() {
          catalogList.classList.remove('hidden');
          productListWrapper.classList.add('hidden');
          catalogList.innerHTML = '';

          Object.entries(catalogData).forEach(([catalog, image]) => {
            const div = document.createElement('div');
            div.className = 'catalog-item';
            div.innerHTML = `
              <img src="${getThumbnailImage(image)}" alt="${catalog}" />
              <div class="catalog-title">${catalog.replace(/-/g, ' ')}<br>(${catalogCounts[catalog]} items)</div>
            `;
            div.onclick = () => showProducts(catalog);
            catalogList.appendChild(div);
          });
        }

        function showProducts(catalog) {
          catalogList.classList.add('hidden');
          productListWrapper.classList.remove('hidden');
          productList.innerHTML = '';
          categoryTitle.textContent = catalog.replace(/-/g, ' ');

          Object.values(productInfo.skuToProductInfo)
            .filter((p) => p.catalog === catalog)
            .forEach((product) => {
              const div = document.createElement('div');
              div.className = 'product-item';
              div.innerHTML = `
                <img src="${getThumbnailImage(product.images[0])}" alt="${product.title}" />
                <div class="product-title">${product.title}<br>₹${product.salePrice}</div>
              `;
              productList.appendChild(div);
            });
        }

        function searchProducts(keyword) {
          const lowerKeyword = keyword.toLowerCase();
          catalogList.classList.add('hidden');
          productListWrapper.classList.remove('hidden');
          categoryTitle.textContent = `Search Results for: "${keyword}"`;
          productList.innerHTML = '';

          const results = Object.values(productInfo.skuToProductInfo).filter(
            (p) => p.title && p.title.toLowerCase().includes(lowerKeyword)
          );

          if (results.length === 0) {
            productList.innerHTML =
              '<p style="margin: 1rem;">No products found.</p>';
            return;
          }

          results.forEach((product) => {
            const div = document.createElement('div');
            div.className = 'product-item';
            div.innerHTML = `
              <img src="${getThumbnailImage(product.images[0])}" alt="${product.title}" />
              <div class="product-title">${product.title}<br>₹${product.salePrice}</div>
            `;
            productList.appendChild(div);
          });
        }

        searchInput.addEventListener('input', () => {
          const keyword = searchInput.value.trim();
          if (keyword === '') {
            showCatalogs();
          } else {
            searchProducts(keyword);
          }
        });

        backLink.onclick = (e) => {
          e.preventDefault();
          searchInput.value = '';
          showCatalogs();
        };

        showCatalogs();
      });
    </script>
  </body>
</html>
